{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///home/runner/workspace/app/admin/qr-download/page.tsx"],"sourcesContent":["\"use client\"\n\nimport { useEffect, useState, useRef } from \"react\"\nimport { useRouter } from \"next/navigation\"\nimport { ChevronLeft, Download, Printer, Loader2, Search, CheckCircle, Circle } from \"lucide-react\"\nimport { QRCodeSVG } from \"qrcode.react\"\nimport jsPDF from \"jspdf\"\nimport html2canvas from \"html2canvas\"\nimport { toast } from \"sonner\"\n\ninterface Student {\n  _id: string\n  name: string\n  code: string\n  academicYear: string\n}\n\nexport default function QRDownloadPage() {\n  const router = useRouter()\n  const [students, setStudents] = useState<Student[]>([])\n  const [filteredStudents, setFilteredStudents] = useState<Student[]>([])\n  const [selectedIds, setSelectedIds] = useState<Set<string>>(new Set())\n  const [isLoading, setIsLoading] = useState(true)\n  const [isDownloading, setIsDownloading] = useState(false)\n  const [searchQuery, setSearchQuery] = useState(\"\")\n  const printRef = useRef<HTMLDivElement>(null)\n\n  useEffect(() => {\n    const fetchStudents = async () => {\n      try {\n        const res = await fetch('/api/students')\n        if (res.ok) {\n          const data = await res.json()\n          setStudents(data)\n          setFilteredStudents(data)\n        }\n      } catch (error) {\n        console.error(\"Error fetching students:\", error)\n        toast.error(\"Failed to load students\")\n      } finally {\n        setIsLoading(false)\n      }\n    }\n    fetchStudents()\n  }, [])\n\n  useEffect(() => {\n    const filtered = students.filter(s => \n      s.name.toLowerCase().includes(searchQuery.toLowerCase()) || \n      s.code.toLowerCase().includes(searchQuery.toLowerCase())\n    )\n    setFilteredStudents(filtered)\n  }, [searchQuery, students])\n\n  const toggleSelect = (id: string) => {\n    const newSelected = new Set(selectedIds)\n    if (newSelected.has(id)) {\n      newSelected.delete(id)\n    } else {\n      newSelected.add(id)\n    }\n    setSelectedIds(newSelected)\n  }\n\n  const selectAll = () => {\n    if (selectedIds.size === filteredStudents.length) {\n      setSelectedIds(new Set())\n    } else {\n      setSelectedIds(new Set(filteredStudents.map(s => s._id)))\n    }\n  }\n\n  const handleDownloadPDF = async () => {\n    if (!printRef.current) return\n    setIsDownloading(true)\n    try {\n      // Temporarily show only selected students for capture\n      const canvas = await html2canvas(printRef.current, {\n        scale: 2,\n        useCORS: true,\n        logging: false,\n      })\n      const imgData = canvas.toDataURL('image/png')\n      const pdf = new jsPDF('p', 'mm', 'a4')\n      const imgProps = pdf.getImageProperties(imgData)\n      const pdfWidth = pdf.internal.pageSize.getWidth()\n      const pdfHeight = (imgProps.height * pdfWidth) / imgProps.width\n      \n      pdf.addImage(imgData, 'PNG', 0, 0, pdfWidth, pdfHeight)\n      pdf.save(`QR_Codes_${selectedIds.size > 0 ? 'Selected' : 'Bulk'}_${new Date().toISOString().split('T')[0]}.pdf`)\n      toast.success(\"QR Codes downloaded successfully\")\n    } catch (error) {\n      console.error(\"PDF Generation error:\", error)\n      toast.error(\"Failed to generate PDF\")\n    } finally {\n      setIsDownloading(false)\n    }\n  }\n\n  const handlePrint = () => {\n    window.print()\n  }\n\n  if (isLoading) {\n    return (\n      <div className=\"min-h-screen flex items-center justify-center bg-gray-50\">\n        <Loader2 className=\"w-8 h-8 animate-spin text-[#4a6670]\" />\n      </div>\n    )\n  }\n\n  const displayStudents = selectedIds.size > 0 \n    ? students.filter(s => selectedIds.has(s._id))\n    : filteredStudents\n\n  return (\n    <div className=\"min-h-screen bg-gray-100 p-4 md:p-8\">\n      <div className=\"max-w-6xl mx-auto\">\n        {/* Header - Hidden on print */}\n        <div className=\"flex flex-col gap-6 mb-8 print:hidden\">\n          <div className=\"flex items-center justify-between\">\n            <div className=\"flex items-center gap-4\">\n              <button \n                onClick={() => router.back()} \n                className=\"p-2 hover:bg-white rounded-full transition-colors shadow-sm\"\n              >\n                <ChevronLeft className=\"w-6 h-6 text-[#4a6670]\" />\n              </button>\n              <h1 className=\"text-2xl font-bold text-[#171532]\">QR Codes Download</h1>\n            </div>\n            <div className=\"flex gap-3\">\n              <button\n                onClick={handlePrint}\n                className=\"flex items-center gap-2 bg-[#4a6670] hover:bg-[#3d565e] text-white px-4 py-2 rounded-lg font-semibold transition-colors\"\n              >\n                <Printer className=\"w-5 h-5\" />\n                Print\n              </button>\n              <button\n                onClick={handleDownloadPDF}\n                disabled={isDownloading}\n                className=\"flex items-center gap-2 bg-[#10B981] hover:bg-[#0fa06f] text-white px-4 py-2 rounded-lg font-semibold transition-colors disabled:opacity-50\"\n              >\n                {isDownloading ? <Loader2 className=\"w-5 h-5 animate-spin\" /> : <Download className=\"w-5 h-5\" />}\n                Download PDF\n              </button>\n            </div>\n          </div>\n\n          <div className=\"flex flex-col md:flex-row gap-4\">\n            <div className=\"relative flex-1\">\n              <Search className=\"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400\" />\n              <input\n                type=\"text\"\n                placeholder=\"Search by name or code...\"\n                value={searchQuery}\n                onChange={(e) => setSearchQuery(e.target.value)}\n                className=\"w-full pl-10 pr-4 py-2.5 bg-white border border-gray-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-[#4a6670] transition-all\"\n              />\n            </div>\n            <button\n              onClick={selectAll}\n              className=\"px-6 py-2.5 bg-white border border-gray-200 rounded-xl font-bold text-[#4a6670] hover:bg-gray-50 transition-all shadow-sm\"\n            >\n              {selectedIds.size === filteredStudents.length && filteredStudents.length > 0 ? \"Deselect All\" : \"Select All\"}\n            </button>\n          </div>\n          \n          <p className=\"text-sm text-gray-500 font-medium\">\n            {selectedIds.size > 0 \n              ? `${selectedIds.size} student(s) selected for download` \n              : `Showing ${filteredStudents.length} student(s). Select individual students or download all.`}\n          </p>\n        </div>\n\n        <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-8 items-start\">\n          {/* Selection Grid - Hidden on print */}\n          <div className=\"bg-white rounded-2xl shadow-sm border border-gray-100 p-4 max-h-[600px] overflow-y-auto print:hidden\">\n            <div className=\"grid grid-cols-1 sm:grid-cols-2 gap-3\">\n              {filteredStudents.map((student) => (\n                <button\n                  key={student._id}\n                  onClick={() => toggleSelect(student._id)}\n                  className={`flex items-center gap-3 p-3 rounded-xl border transition-all ${\n                    selectedIds.has(student._id)\n                      ? \"bg-[#4a6670]/5 border-[#4a6670] ring-1 ring-[#4a6670]\"\n                      : \"bg-white border-gray-100 hover:border-gray-300\"\n                  }`}\n                >\n                  {selectedIds.has(student._id) ? (\n                    <CheckCircle className=\"w-5 h-5 text-[#4a6670]\" />\n                  ) : (\n                    <Circle className=\"w-5 h-5 text-gray-300\" />\n                  )}\n                  <div className=\"text-left overflow-hidden\">\n                    <p className=\"text-sm font-bold text-[#171532] truncate\">{student.name}</p>\n                    <p className=\"text-[10px] text-gray-500 font-mono\">{student.code}</p>\n                  </div>\n                </button>\n              ))}\n            </div>\n          </div>\n\n          {/* A4 Preview Container */}\n          <div className=\"bg-white shadow-xl mx-auto overflow-hidden print:shadow-none print:m-0 sticky top-8\" style={{ width: '210mm', minHeight: '297mm', padding: '10mm' }}>\n            <div ref={printRef} className=\"bg-white\">\n              <h2 className=\"text-center text-xl font-bold mb-6 text-gray-800 print:block hidden\">JDSA Student QR Codes</h2>\n              \n              <div className=\"grid grid-cols-7 gap-2\">\n                {displayStudents.map((student) => (\n                  <div key={student._id} className=\"flex flex-col items-center p-2 border border-gray-100 rounded\">\n                    <div className=\"bg-white p-1\">\n                      <QRCodeSVG value={student.code} size={80} level=\"M\" />\n                    </div>\n                    <p className=\"text-[8px] font-bold text-center mt-1 truncate w-full\">{student.name}</p>\n                    <p className=\"text-[7px] text-gray-500 text-center uppercase\">{student.code}</p>\n                  </div>\n                ))}\n              </div>\n            </div>\n          </div>\n        </div>\n        \n        {/* Mobile Warning */}\n        <div className=\"mt-8 text-center text-sm text-gray-500 md:hidden print:hidden\">\n          Note: For best layout results, use a desktop browser to download or print.\n        </div>\n      </div>\n\n      <style jsx global>{`\n        @media print {\n          body {\n            background: white !important;\n            padding: 0 !important;\n            margin: 0 !important;\n          }\n          .print\\:hidden {\n            display: none !important;\n          }\n          @page {\n            size: A4;\n            margin: 0;\n          }\n        }\n      `}</style>\n    </div>\n  )\n}\n"],"names":[],"mappings":"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"}}]
}