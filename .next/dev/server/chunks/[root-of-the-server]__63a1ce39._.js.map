{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///home/runner/workspace/lib/mongodb.ts"],"sourcesContent":["import mongoose from 'mongoose';\n\nconst MONGODB_URI = process.env.MONGODB_URI || 'mongodb://localhost:27017/jdsa-bank';\n\nif (!MONGODB_URI) {\n  throw new Error('Please define the MONGODB_URI environment variable');\n}\n\nlet cached = global.mongoose;\n\nif (!cached) {\n  cached = global.mongoose = { conn: null, promise: null };\n}\n\nexport async function connectDB() {\n  if (cached.conn) {\n    return cached.conn;\n  }\n\n  if (!cached.promise) {\n    const opts = {\n      bufferCommands: false,\n    };\n\n    cached.promise = mongoose.connect(MONGODB_URI, opts).then((mongoose) => {\n      return mongoose;\n    });\n  }\n\n  try {\n    cached.conn = await cached.promise;\n  } catch (e) {\n    cached.promise = null;\n    throw e;\n  }\n\n  return cached.conn;\n}\n\ndeclare global {\n  var mongoose: any;\n}\n"],"names":[],"mappings":";;;;AAAA;;AAEA,MAAM,cAAc,QAAQ,GAAG,CAAC,WAAW,IAAI;AAE/C;;AAIA,IAAI,SAAS,yDAAO,QAAQ;AAE5B,IAAI,CAAC,QAAQ;IACX,SAAS,yDAAO,QAAQ,GAAG;QAAE,MAAM;QAAM,SAAS;IAAK;AACzD;AAEO,eAAe;IACpB,IAAI,OAAO,IAAI,EAAE;QACf,OAAO,OAAO,IAAI;IACpB;IAEA,IAAI,CAAC,OAAO,OAAO,EAAE;QACnB,MAAM,OAAO;YACX,gBAAgB;QAClB;QAEA,OAAO,OAAO,GAAG,oHAAQ,CAAC,OAAO,CAAC,aAAa,MAAM,IAAI,CAAC,CAAC;YACzD,OAAO;QACT;IACF;IAEA,IAAI;QACF,OAAO,IAAI,GAAG,MAAM,OAAO,OAAO;IACpC,EAAE,OAAO,GAAG;QACV,OAAO,OAAO,GAAG;QACjB,MAAM;IACR;IAEA,OAAO,OAAO,IAAI;AACpB"}},
    {"offset": {"line": 86, "column": 0}, "map": {"version":3,"sources":["file:///home/runner/workspace/lib/models/Student.ts"],"sourcesContent":["import mongoose, { Schema, Document } from 'mongoose';\n\ninterface Transaction {\n  type: 'deposit' | 'withdraw';\n  amount: number;\n  date?: string;\n  reason?: string;\n}\n\nexport interface IStudent extends Document {\n  name: string;\n  code: string;\n  email?: string;\n  mobile?: string;\n  profileImage?: string;\n  balance: number;\n  transactions: Transaction[];\n  createdAt: Date;\n  updatedAt: Date;\n}\n\nconst transactionSchema = new Schema({\n  type: { type: String, enum: ['deposit', 'withdraw'], required: true },\n  amount: { type: Number, required: true },\n  date: { type: String },\n  reason: { type: String },\n});\n\nconst studentSchema = new Schema<IStudent>(\n  {\n    name: { type: String, required: true },\n    code: { type: String, required: true, unique: true },\n    email: { type: String },\n    mobile: { type: String },\n    profileImage: { type: String },\n    balance: { type: Number, default: 0 },\n    transactions: [transactionSchema],\n  },\n  { timestamps: true }\n);\n\nexport const Student = mongoose.models.Student || mongoose.model<IStudent>('Student', studentSchema);\n"],"names":[],"mappings":";;;;AAAA;;AAqBA,MAAM,oBAAoB,IAAI,mHAAM,CAAC;IACnC,MAAM;QAAE,MAAM;QAAQ,MAAM;YAAC;YAAW;SAAW;QAAE,UAAU;IAAK;IACpE,QAAQ;QAAE,MAAM;QAAQ,UAAU;IAAK;IACvC,MAAM;QAAE,MAAM;IAAO;IACrB,QAAQ;QAAE,MAAM;IAAO;AACzB;AAEA,MAAM,gBAAgB,IAAI,mHAAM,CAC9B;IACE,MAAM;QAAE,MAAM;QAAQ,UAAU;IAAK;IACrC,MAAM;QAAE,MAAM;QAAQ,UAAU;QAAM,QAAQ;IAAK;IACnD,OAAO;QAAE,MAAM;IAAO;IACtB,QAAQ;QAAE,MAAM;IAAO;IACvB,cAAc;QAAE,MAAM;IAAO;IAC7B,SAAS;QAAE,MAAM;QAAQ,SAAS;IAAE;IACpC,cAAc;QAAC;KAAkB;AACnC,GACA;IAAE,YAAY;AAAK;AAGd,MAAM,UAAU,oHAAQ,CAAC,MAAM,CAAC,OAAO,IAAI,oHAAQ,CAAC,KAAK,CAAW,WAAW"}},
    {"offset": {"line": 152, "column": 0}, "map": {"version":3,"sources":["file:///home/runner/workspace/app/api/students/bulk-transaction/route.ts"],"sourcesContent":["import { connectDB } from \"@/lib/mongodb\"\nimport { Student } from \"@/lib/models/Student\"\nimport { NextResponse } from \"next/server\"\n\ninterface BulkTransaction {\n  studentCode: string\n  date: string\n  type: \"deposit\" | \"withdrawal\" | \"withdraw\"\n  amount: number\n}\n\nexport async function POST(req: Request) {\n  try {\n    await connectDB()\n\n    const body = await req.json()\n    const { transactions } = body as { transactions: BulkTransaction[] }\n\n    if (!Array.isArray(transactions) || transactions.length === 0) {\n      return NextResponse.json(\n        { error: \"No transactions provided\" },\n        { status: 400 }\n      )\n    }\n\n    let successCount = 0\n    let failureCount = 0\n    const errors: string[] = []\n\n    // Process each transaction\n    for (const transaction of transactions) {\n      try {\n        // Validate transaction\n        if (!transaction.studentCode || !transaction.date || !transaction.type || transaction.amount === undefined) {\n          failureCount++\n          errors.push(`Missing required fields for student: ${transaction.studentCode}`)\n          continue\n        }\n\n        if (![\"deposit\", \"withdrawal\", \"withdraw\"].includes(transaction.type)) {\n          failureCount++\n          errors.push(`Invalid type for ${transaction.studentCode}: ${transaction.type}`)\n          continue\n        }\n\n        if (isNaN(transaction.amount) || transaction.amount <= 0) {\n          failureCount++\n          errors.push(`Invalid amount for ${transaction.studentCode}: ${transaction.amount}`)\n          continue\n        }\n\n        // Find student by code\n        const student = await Student.findOne({ code: transaction.studentCode })\n        if (!student) {\n          failureCount++\n          errors.push(`Student not found: ${transaction.studentCode}`)\n          continue\n        }\n\n        // Normalize type: convert \"withdrawal\" to \"withdraw\"\n        const normalizedType = transaction.type === \"withdrawal\" ? \"withdraw\" : transaction.type\n\n        // Add transaction\n        student.transactions.push({\n          date: transaction.date,\n          type: normalizedType,\n          amount: transaction.amount,\n        })\n\n        // Update balance\n        const balanceChange = normalizedType === \"deposit\" ? transaction.amount : -transaction.amount\n        student.balance += balanceChange\n\n        student.markModified(\"transactions\")\n        await student.save()\n\n        successCount++\n      } catch (error) {\n        failureCount++\n        errors.push(`Error processing ${transaction.studentCode}: ${String(error)}`)\n      }\n    }\n\n    return NextResponse.json({\n      success: true,\n      successCount,\n      failureCount,\n      errors: errors.length > 0 ? errors : undefined,\n    })\n  } catch (error) {\n    console.error(\"Error bulk uploading transactions:\", error)\n    return NextResponse.json(\n      { error: \"Internal server error\", details: String(error) },\n      { status: 500 }\n    )\n  }\n}\n"],"names":[],"mappings":";;;;AAAA;AACA;AACA;;;;AASO,eAAe,KAAK,GAAY;IACrC,IAAI;QACF,MAAM,IAAA,6HAAS;QAEf,MAAM,OAAO,MAAM,IAAI,IAAI;QAC3B,MAAM,EAAE,YAAY,EAAE,GAAG;QAEzB,IAAI,CAAC,MAAM,OAAO,CAAC,iBAAiB,aAAa,MAAM,KAAK,GAAG;YAC7D,OAAO,gJAAY,CAAC,IAAI,CACtB;gBAAE,OAAO;YAA2B,GACpC;gBAAE,QAAQ;YAAI;QAElB;QAEA,IAAI,eAAe;QACnB,IAAI,eAAe;QACnB,MAAM,SAAmB,EAAE;QAE3B,2BAA2B;QAC3B,KAAK,MAAM,eAAe,aAAc;YACtC,IAAI;gBACF,uBAAuB;gBACvB,IAAI,CAAC,YAAY,WAAW,IAAI,CAAC,YAAY,IAAI,IAAI,CAAC,YAAY,IAAI,IAAI,YAAY,MAAM,KAAK,WAAW;oBAC1G;oBACA,OAAO,IAAI,CAAC,CAAC,qCAAqC,EAAE,YAAY,WAAW,EAAE;oBAC7E;gBACF;gBAEA,IAAI,CAAC;oBAAC;oBAAW;oBAAc;iBAAW,CAAC,QAAQ,CAAC,YAAY,IAAI,GAAG;oBACrE;oBACA,OAAO,IAAI,CAAC,CAAC,iBAAiB,EAAE,YAAY,WAAW,CAAC,EAAE,EAAE,YAAY,IAAI,EAAE;oBAC9E;gBACF;gBAEA,IAAI,MAAM,YAAY,MAAM,KAAK,YAAY,MAAM,IAAI,GAAG;oBACxD;oBACA,OAAO,IAAI,CAAC,CAAC,mBAAmB,EAAE,YAAY,WAAW,CAAC,EAAE,EAAE,YAAY,MAAM,EAAE;oBAClF;gBACF;gBAEA,uBAAuB;gBACvB,MAAM,UAAU,MAAM,qIAAO,CAAC,OAAO,CAAC;oBAAE,MAAM,YAAY,WAAW;gBAAC;gBACtE,IAAI,CAAC,SAAS;oBACZ;oBACA,OAAO,IAAI,CAAC,CAAC,mBAAmB,EAAE,YAAY,WAAW,EAAE;oBAC3D;gBACF;gBAEA,qDAAqD;gBACrD,MAAM,iBAAiB,YAAY,IAAI,KAAK,eAAe,aAAa,YAAY,IAAI;gBAExF,kBAAkB;gBAClB,QAAQ,YAAY,CAAC,IAAI,CAAC;oBACxB,MAAM,YAAY,IAAI;oBACtB,MAAM;oBACN,QAAQ,YAAY,MAAM;gBAC5B;gBAEA,iBAAiB;gBACjB,MAAM,gBAAgB,mBAAmB,YAAY,YAAY,MAAM,GAAG,CAAC,YAAY,MAAM;gBAC7F,QAAQ,OAAO,IAAI;gBAEnB,QAAQ,YAAY,CAAC;gBACrB,MAAM,QAAQ,IAAI;gBAElB;YACF,EAAE,OAAO,OAAO;gBACd;gBACA,OAAO,IAAI,CAAC,CAAC,iBAAiB,EAAE,YAAY,WAAW,CAAC,EAAE,EAAE,OAAO,QAAQ;YAC7E;QACF;QAEA,OAAO,gJAAY,CAAC,IAAI,CAAC;YACvB,SAAS;YACT;YACA;YACA,QAAQ,OAAO,MAAM,GAAG,IAAI,SAAS;QACvC;IACF,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,sCAAsC;QACpD,OAAO,gJAAY,CAAC,IAAI,CACtB;YAAE,OAAO;YAAyB,SAAS,OAAO;QAAO,GACzD;YAAE,QAAQ;QAAI;IAElB;AACF"}}]
}