{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///home/runner/workspace/app/user/transactions/page.tsx"],"sourcesContent":["\"use client\"\n\nimport { useEffect, useState } from \"react\"\nimport { useRouter } from \"next/navigation\"\nimport { Calendar, ArrowLeft, ArrowUpRight, ArrowDownLeft } from \"lucide-react\"\nimport { format, parse, isWithinInterval, startOfDay, endOfDay } from \"date-fns\"\n\nexport default function TransactionsCalendar() {\n  const router = useRouter()\n  const [userData, setUserData] = useState<any>(null)\n  const [selectedDate, setSelectedDate] = useState<Date | null>(null)\n  const [filteredTransactions, setFilteredTransactions] = useState<any[]>([])\n  const [isLoading, setIsLoading] = useState(true)\n\n  const loadUserData = async () => {\n    try {\n      const verifyRes = await fetch('/api/auth/verify')\n      if (!verifyRes.ok) {\n        router.push(\"/login\")\n        return\n      }\n      \n      const session = await verifyRes.json()\n      const studentId = session.userData.id\n\n      const res = await fetch(`/api/students/${studentId}`, {\n        method: 'GET',\n        cache: 'no-store',\n      })\n      \n      if (!res.ok) return\n      \n      const student = await res.json()\n      setUserData({\n        id: student._id,\n        name: student.name,\n        code: student.code,\n        balance: student.balance,\n        transactions: student.transactions || [],\n      })\n    } catch (error) {\n      console.error(\"Error loading user data:\", error)\n    } finally {\n      setIsLoading(false)\n    }\n  }\n\n  useEffect(() => {\n    loadUserData()\n  }, [])\n\n  const handleDateSelect = (date: Date) => {\n    setSelectedDate(date)\n    if (!userData?.transactions) return\n\n    const dayTransactions = userData.transactions.filter((t: any) => {\n      try {\n        const transactionDate = parse(t.date, \"dd/MM/yyyy\", new Date())\n        return format(transactionDate, \"yyyy-MM-dd\") === format(date, \"yyyy-MM-dd\")\n      } catch {\n        return false\n      }\n    })\n    \n    setFilteredTransactions(dayTransactions)\n  }\n\n  const getDatesWithTransactions = () => {\n    if (!userData?.transactions) return new Set()\n    const dates = new Set<string>()\n    userData.transactions.forEach((t: any) => {\n      try {\n        const transactionDate = parse(t.date, \"dd/MM/yyyy\", new Date())\n        dates.add(format(transactionDate, \"yyyy-MM-dd\"))\n      } catch {\n        // Skip invalid dates\n      }\n    })\n    return dates\n  }\n\n  const datesWithTransactions = getDatesWithTransactions()\n  const today = new Date()\n  const daysInMonth = Array.from({ length: 31 }, (_, i) => {\n    const date = new Date(today.getFullYear(), today.getMonth(), i + 1)\n    return date.getMonth() === today.getMonth() ? date : null\n  }).filter(Boolean) as Date[]\n\n  if (isLoading) {\n    return (\n      <div className=\"min-h-screen bg-gradient-to-br from-[#f8f9fa] to-[#e8eef5] p-4\">\n        <div className=\"max-w-md mx-auto flex items-center justify-center min-h-screen\">\n          <div className=\"text-center\">\n            <div className=\"w-12 h-12 border-4 border-[#e5e7eb] border-t-[#4a6670] rounded-full animate-spin mx-auto\"></div>\n            <p className=\"mt-4 text-[#747384]\">Loading transactions...</p>\n          </div>\n        </div>\n      </div>\n    )\n  }\n\n  return (\n    <div className=\"min-h-screen bg-gradient-to-br from-[#f8f9fa] to-[#e8eef5] p-4\">\n      <div className=\"max-w-md mx-auto\">\n        {/* Header */}\n        <div className=\"flex items-center gap-3 mb-6 pt-4\">\n          <button\n            onClick={() => router.back()}\n            className=\"p-2 hover:bg-white rounded-lg transition-colors\"\n          >\n            <ArrowLeft className=\"w-5 h-5 text-[#4a6670]\" />\n          </button>\n          <div className=\"flex items-center gap-2\">\n            <Calendar className=\"w-5 h-5 text-[#4a6670]\" />\n            <h1 className=\"text-2xl font-bold text-[#171532]\">Filter by Date</h1>\n          </div>\n        </div>\n\n        {/* Calendar Grid */}\n        <div className=\"bg-white rounded-2xl shadow-lg p-6 mb-6\">\n          <h2 className=\"text-lg font-semibold text-[#171532] mb-4\">\n            {format(today, \"MMMM yyyy\")}\n          </h2>\n\n          {/* Day headers */}\n          <div className=\"grid grid-cols-7 gap-2 mb-4\">\n            {[\"Sun\", \"Mon\", \"Tue\", \"Wed\", \"Thu\", \"Fri\", \"Sat\"].map(day => (\n              <div key={day} className=\"text-center text-xs font-bold text-[#747384] py-2\">\n                {day}\n              </div>\n            ))}\n          </div>\n\n          {/* Calendar days */}\n          <div className=\"grid grid-cols-7 gap-2\">\n            {daysInMonth.map((date, idx) => {\n              const dateStr = format(date, \"yyyy-MM-dd\")\n              const hasTransaction = datesWithTransactions.has(dateStr)\n              const isSelected = selectedDate && format(selectedDate, \"yyyy-MM-dd\") === dateStr\n\n              return (\n                <button\n                  key={idx}\n                  onClick={() => handleDateSelect(date)}\n                  className={`aspect-square rounded-lg font-semibold text-sm transition-colors ${\n                    isSelected\n                      ? \"bg-[#4a6670] text-white\"\n                      : hasTransaction\n                      ? \"bg-[#e8f5e9] text-[#2e7d32] hover:bg-[#c8e6c9]\"\n                      : \"bg-[#f5f5f5] text-[#747384] hover:bg-[#e8e8e8]\"\n                  }`}\n                >\n                  {date.getDate()}\n                </button>\n              )\n            })}\n          </div>\n        </div>\n\n        {/* Transactions for selected date */}\n        {selectedDate && (\n          <div className=\"bg-white rounded-2xl shadow-lg p-6\">\n            <h3 className=\"text-lg font-semibold text-[#171532] mb-4\">\n              Transactions on {format(selectedDate, \"dd MMM yyyy\")}\n            </h3>\n\n            {filteredTransactions.length > 0 ? (\n              <div className=\"space-y-3\">\n                {filteredTransactions.map((transaction: any, idx: number) => (\n                  <div\n                    key={idx}\n                    className=\"flex items-center justify-between p-4 bg-[#f8f9fa] rounded-lg border border-[#e5e7eb] hover:border-[#4a6670] transition-colors\"\n                  >\n                    <div className=\"flex items-center gap-3\">\n                      <div className={`p-2 rounded-lg ${\n                        transaction.type === 'deposit'\n                          ? 'bg-green-100'\n                          : 'bg-red-100'\n                      }`}>\n                        {transaction.type === 'deposit' ? (\n                          <ArrowDownLeft className={`w-5 h-5 text-green-600`} />\n                        ) : (\n                          <ArrowUpRight className={`w-5 h-5 text-red-600`} />\n                        )}\n                      </div>\n                      <div>\n                        <p className=\"font-semibold text-[#171532] capitalize\">\n                          {transaction.type}\n                        </p>\n                        <p className=\"text-xs text-[#747384]\">{transaction.date}</p>\n                      </div>\n                    </div>\n                    <p className={`font-bold text-lg ${\n                      transaction.type === 'deposit'\n                        ? 'text-green-600'\n                        : 'text-red-600'\n                    }`}>\n                      {transaction.type === 'deposit' ? '+' : '-'}â‚¹{transaction.amount?.toFixed(2)}\n                    </p>\n                  </div>\n                ))}\n              </div>\n            ) : (\n              <p className=\"text-center text-[#747384] py-8\">No transactions on this date</p>\n            )}\n          </div>\n        )}\n      </div>\n    </div>\n  )\n}\n"],"names":[],"mappings":"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"}}]
}